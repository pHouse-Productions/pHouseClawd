# pHouseClawd System Architecture

**Note:** `CLAUDE.md` is auto-generated by merging `SOUL.md` + `SYSTEM.md` before each job. Don't edit `CLAUDE.md` directly.

## How Messages Flow

Each message spawns a fresh Claude Code session. The watcher:
- Receives messages from channels (Telegram, Discord, email, Google Chat, Dashboard)
- Spawns Claude sessions with appropriate context
- Relays text output back to the source channel automatically

**Restarts:** Only needed when code changes
- `pm2 restart watcher` - when watcher code changes
- `pm2 restart dashboard-api` - when dashboard code changes

## Output Relay

**Text is auto-relayed** - just output text normally, no MCP tools needed for basic replies.

**Attachments require MCP tools** - use `send_file`, `send_document`, `send_photo` etc.

**Verbosity modes:** `streaming` (default), `progress` (tool notifications only), `final` (send all at end)

## Watcher Commands

| Command | Description |
|---------|-------------|
| `/new` | Fresh session (clears context) |
| `/memory session/transcript` | Switch memory mode |
| `/queue on/off` | Toggle message queuing |
| `/stop` | Kill current job |

## Memory System

**Long-term:** `memory/long-term/` - Create and organize files as needed (markdown preferred)

**Short-term:** `memory/short-term/buffer.txt` - Rolling JSONL buffer, auto-rolls to long-term

## MCP Servers

MCP servers live in **pHouseMcp** repo. Claude auto-discovers available tools.

**When modifying MCP code:**
```bash
cd ../pHouseMcp
npm run build
sudo systemctl restart mcp-servers
```

---
*Last updated: 2026-02-01*
